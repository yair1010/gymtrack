<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="GymLog">
    <meta name="application-name" content="GymLog">
    <meta name="theme-color" content="#1c1c1e">
    <meta name="msapplication-TileColor" content="#ff3b30">
    <meta name="description" content="Track your workouts, monitor progress, and achieve your fitness goals">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'><rect width='180' height='180' fill='%231c1c1e'/><text x='50%' y='50%' font-size='80' text-anchor='middle' dy='0.35em' fill='%23ff3b30' font-family='system-ui, sans-serif' font-weight='bold'>ðŸ’ª</text></svg>">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ðŸ’ª</text></svg>">
    
    <!-- Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkd5bUxvZyAtIFdvcmtvdXQgVHJhY2tlciIsCiAgInNob3J0X25hbWUiOiAiR3ltTG9nIiwKICAic3RhcnRfdXJsIjogIi4iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiMxYzFjMWUiLAogICJ0aGVtZV9jb2xvciI6ICIjZmYzYjMwIiwKICAiZGVzY3JpcHRpb24iOiAiVHJhY2sgeW91ciB3b3Jrb3V0cywgbW9uaXRvciBwcm9ncmVzcywgYW5kIGFjaGlldmUgeW91ciBmaXRuZXNzIGdvYWxzIiwKICAib3JpZW50YXRpb24iOiAicG9ydHJhaXQiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWwsPHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAxOTIgMTkyJz48cmVjdCB3aWR0aD0nMTkyJyBoZWlnaHQ9JzE5MicgZmlsbD0nJTIzMWMxYzFlJy8+PHRleHQgeD0nNTAlJyB5PSc1MCUnIGZvbnQtc2l6ZT0nMTAwJyB0ZXh0LWFuY2hvcj0nbWlkZGxlJyBkeT0nMC4zNWVtJyBmaWxsPSclMjNmZjNiMzAnPvCfkqo8L3RleHQ+PC9zdmc+IiwKICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfSwKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWwsPHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCA1MTIgNTEyJz48cmVjdCB3aWR0aD0nNTEyJyBoZWlnaHQ9JzUxMicgZmlsbD0nJTIzMWMxYzFlJy8+PHRleHQgeD0nNTAlJyB5PSc1MCUnIGZvbnQtc2l6ZT0nMzAwJyB0ZXh0LWFuY2hvcj0nbWlkZGxlJyBkeT0nMC4zNWVtJyBmaWxsPSclMjNmZjNiMzAnPvCfkqo8L3RleHQ+PC9zdmc+IiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0KfQ==">
    
    <title>GymLog - Workout Tracker</title>
    
    <!-- Fonts (Inline Base64 fallback) -->
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #ff3b30;
            --secondary: #ff9500;
            --dark: #1c1c1e;
            --darker: #000000;
            --card: #2c2c2e;
            --text: #ffffff;
            --text-secondary: #98989d;
            --success: #34c759;
            --accent: #ff375f;
            
            /* Primary color with different opacities */
            --primary-rgb: 255, 59, 48;
            --primary-10: rgba(var(--primary-rgb), 0.1);
            --primary-20: rgba(var(--primary-rgb), 0.2);
            --primary-30: rgba(var(--primary-rgb), 0.3);
            --primary-40: rgba(var(--primary-rgb), 0.4);
            --primary-50: rgba(var(--primary-rgb), 0.5);
            --primary-60: rgba(var(--primary-rgb), 0.6);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }
        
        html {
            height: 100%;
            position: fixed;
            overflow: hidden;
            width: 100%;
        }
        
        body {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--darker);
            color: var(--text);
            overflow-x: hidden;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 80px;
            min-height: 100vh;
            height: 100%;
            position: relative;
            /* Prevent pull-to-refresh */
            overscroll-behavior-y: contain;
        }
        
        /* Gradient Background */
        .bg-gradient {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1c1c1e 0%, #000000 50%, #1a0505 100%);
            z-index: -1;
        }
        
        .bg-gradient::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, var(--primary-10) 0%, transparent 70%);
            animation: pulse 8s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        /* Header */
        .header {
            padding: env(safe-area-inset-top) 20px 20px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .header h1 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.5rem;
            letter-spacing: 2px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header .date {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        /* Quick Stats */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            padding: 20px;
            animation: slideUp 0.5s ease-out;
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .stat-card {
            background: var(--card);
            padding: 15px;
            border-radius: 16px;
            text-align: center;
            border: 1px solid var(--primary-20);
        }
        
        .stat-card .value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            display: block;
        }
        
        .stat-card .label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 5px;
        }
        
        /* Main Container */
        .container {
            padding: 0 20px 20px;
        }
        
        /* Section Headers */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0 15px;
        }
        
        .section-header h2 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.8rem;
            letter-spacing: 1px;
        }
        
        .section-header .btn-link {
            color: var(--primary);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        /* Log Workout Button */
        .log-workout-btn {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            border: none;
            padding: 18px;
            border-radius: 16px;
            font-size: 1.1rem;
            font-weight: 700;
            width: 100%;
            margin: 20px 0;
            cursor: pointer;
            box-shadow: 0 10px 30px var(--primary-40);
            transition: transform 0.2s, box-shadow 0.2s;
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        
        .log-workout-btn:active {
            transform: scale(0.98);
            box-shadow: 0 5px 15px var(--primary-40);
        }
        
        /* Workout History */
        .workout-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .workout-card {
            background: var(--card);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .workout-card:active {
            transform: scale(0.98);
        }
        
        .workout-card .workout-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }
        
        .workout-card .workout-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text);
        }
        
        .workout-card .workout-time {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }
        
        .workout-card .exercises {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .exercise-tag {
            background: var(--primary-20);
            color: var(--primary);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .workout-card .delete-btn {
            background: var(--primary-20);
            border: 1px solid var(--primary-30);
            color: var(--primary);
            padding: 6px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            white-space: nowrap;
        }
        
        .workout-card .edit-btn {
            background: rgba(0, 212, 255, 0.2);
            border: none;
            color: #00d4ff;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            flex: 1;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            animation: fadeIn 0.3s;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal.active {
            display: block;
        }
        
        .modal-content {
            padding: 60px 20px 40px;
            max-width: 500px;
            margin: 0 auto;
            animation: slideUpModal 0.4s ease-out;
            width: 100%;
            box-sizing: border-box;
        }
        
        @keyframes slideUpModal {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .modal-header h2 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            letter-spacing: 1px;
        }
        
        .close-btn {
            background: var(--card);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Form */
        .form-group {
            margin-bottom: 20px;
            max-width: 100%;
            box-sizing: border-box;
        }
        
        .form-group label {
            display: block;
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 15px;
            background: var(--card);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            font-family: 'Roboto', sans-serif;
            box-sizing: border-box;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        /* Exercise Entry */
        .exercise-entry {
            background: var(--card);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 100%;
            box-sizing: border-box;
            overflow: hidden;
        }
        
        .exercise-entry .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .exercise-entry .exercise-name {
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .remove-exercise {
            background: transparent;
            border: none;
            color: var(--primary);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px 10px;
        }
        
        .sets-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .set-row {
            display: grid;
            grid-template-columns: 40px 1fr 1fr 35px;
            gap: 8px;
            align-items: center;
            max-width: 100%;
        }
        
        .set-row .set-number {
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-weight: 500;
        }
        
        .set-row input {
            padding: 10px 8px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: white;
            font-size: 0.9rem;
            text-align: center;
            width: 100%;
            box-sizing: border-box;
            min-width: 0;
        }
        
        .add-set-btn {
            background: var(--primary-20);
            border: none;
            color: var(--primary);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .remove-set-btn {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 1.2rem;
            cursor: pointer;
        }
        
        /* Buttons */
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            border: none;
            padding: 16px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            width: 100%;
            cursor: pointer;
            margin-top: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-secondary {
            background: var(--card);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 16px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            width: 100%;
            cursor: pointer;
            margin-top: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }
        
        .empty-state .icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .empty-state p {
            font-size: 1.1rem;
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 8px 0 calc(8px + env(safe-area-inset-bottom));
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            z-index: 100;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 4px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.7rem;
            transition: color 0.3s;
        }
        
        .nav-item.active {
            color: var(--primary);
        }
        
        .nav-item .icon {
            font-size: 1.3rem;
            margin-bottom: 3px;
        }
        
        
        /* Progress Analytics */
        .progress-container {
            display: none;
            padding: 20px;
            animation: fadeIn 0.3s;
            padding-bottom: 100px;
        }
        
        .progress-container.active {
            display: block;
        }
        
        .progress-header {
            margin-bottom: 25px;
        }
        
        .progress-header h2 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }
        
        .period-btn {
            padding: 12px;
            background: var(--card);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            color: var(--text);
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .period-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-color: var(--primary);
            color: white;
            box-shadow: 0 4px 15px var(--primary-40);
        }
        
        .period-btn:active {
            transform: scale(0.95);
        }
        
        .view-tab-btn {
            padding: 12px;
            background: var(--card);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            color: var(--text);
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .view-tab-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-color: var(--primary);
            color: white;
            box-shadow: 0 4px 15px var(--primary-40);
        }
        
        .view-tab-btn:active {
            transform: scale(0.95);
        }
        
        .muscle-summary-item {
            background: var(--card);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 10px;
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .muscle-name {
            font-weight: 600;
            font-size: 1.05rem;
            color: var(--text);
        }
        
        .muscle-sets-count {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
            font-family: 'Bebas Neue', sans-serif;
            letter-spacing: 1px;
        }
        
        .progress-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .control-group label {
            color: var(--text-secondary);
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }
        
        .control-group select {
            padding: 15px;
            background: var(--card);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            font-size: 1rem;
        }
        
        .metric-toggle {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .metric-btn {
            padding: 12px;
            background: var(--card);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .metric-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-color: var(--primary);
            color: white;
        }
        
        .chart-container {
            background: var(--card);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.3rem;
            letter-spacing: 1px;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .chart {
            max-height: 500px;
            overflow-y: auto;
            overflow-x: hidden;
            position: relative;
        }
        
        .chart-canvas {
            width: 100%;
            height: 100%;
        }
        
        .no-data {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }
        
        .no-data .icon {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-box {
            background: var(--card);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }
        
        .stat-box .value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            display: block;
            margin-bottom: 5px;
        }
        
        .stat-box .label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .trend {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            margin-top: 8px;
            padding: 5px 10px;
            border-radius: 20px;
        }
        
        .trend.up {
            background: rgba(52, 199, 89, 0.2);
            color: var(--success);
        }
        
        .trend.down {
            background: var(--primary-20);
            color: var(--primary);
        }
        
        /* Validation */
        .validation-error {
            background: var(--primary-20);
            border: 1px solid var(--primary);
            color: var(--text);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .validation-error .error-title {
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--primary);
        }
        
        .validation-error ul {
            margin: 0;
            padding-left: 20px;
        }
        
        .validation-error li {
            margin: 5px 0;
        }
        
        /* Workout Detail View */
        .workout-detail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--darker);
            z-index: 2000;
            animation: slideInRight 0.3s ease-out;
            overflow-y: auto;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
            }
            to {
                transform: translateX(0);
            }
        }
        
        .workout-detail-modal.active {
            display: block;
        }
        
        .detail-header {
            padding: env(safe-area-inset-top) 20px 20px;
            background: var(--card);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            z-index: 10;
            backdrop-filter: blur(20px);
        }
        
        .detail-header-top {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .back-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.3rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .back-btn:active {
            transform: scale(0.9);
            background: rgba(255, 255, 255, 0.2);
        }
        
        .detail-header h2 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.8rem;
            letter-spacing: 1px;
            flex: 1;
        }
        
        .detail-header .workout-meta {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }
        
        .detail-content {
            padding: 20px;
        }
        
        .exercise-detail {
            background: var(--card);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .exercise-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .exercise-detail-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text);
        }
        
        .exercise-detail-sets-count {
            background: var(--primary-20);
            color: var(--primary);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .sets-detail-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .set-detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }
        
        .set-detail-number {
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .set-detail-values {
            display: flex;
            gap: 20px;
        }
        
        .set-detail-value {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .set-detail-value .label {
            color: var(--text-secondary);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 3px;
        }
        
        .set-detail-value .value {
            color: var(--text);
            font-size: 1.1rem;
            font-weight: 700;
        }
        
        .workout-summary {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 20px;
            color: white;
        }
        
        .workout-summary h3 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            letter-spacing: 1px;
            margin-bottom: 15px;
        }
        
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }
        
        .summary-stat {
            text-align: center;
        }
        
        .summary-stat .value {
            font-size: 1.8rem;
            font-weight: 700;
            display: block;
        }
        
        .summary-stat .label {
            font-size: 0.8rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Muscle Diagram */
        .muscle-diagram-container {
            background: var(--card);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .muscle-diagram-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.3rem;
            letter-spacing: 1px;
            margin-bottom: 20px;
            color: var(--primary);
            text-align: center;
        }
        
        .muscle-views {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .muscle-view {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 12px;
        }
        
        .muscle-view-label {
            font-size: 1rem;
            color: var(--text);
            margin-bottom: 15px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-align: center;
        }
        
        .muscle-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .muscle-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }
        
        .muscle-item.active {
            background: linear-gradient(135deg, var(--primary-30), var(--primary-30));
            border-color: var(--primary);
            box-shadow: 0 0 15px var(--primary-40);
            animation: pulseGlow 2s ease-in-out infinite;
        }
        
        @keyframes pulseGlow {
            0%, 100% { 
                box-shadow: 0 0 15px var(--primary-40);
            }
            50% { 
                box-shadow: 0 0 25px var(--primary-60);
            }
        }
        
        .muscle-icon {
            font-size: 1.5rem;
            width: 30px;
            text-align: center;
        }
        
        .muscle-label {
            flex: 1;
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--text-secondary);
        }
        
        .muscle-item.active .muscle-label {
            color: var(--text);
            font-weight: 600;
        }
        
        .muscle-status {
            font-size: 1.2rem;
            color: var(--primary);
            font-weight: 700;
        }
        
        /* SVG Muscle Diagrams */
        .muscle-diagrams {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .muscle-svg {
            width: 100%;
            height: auto;
            max-height: 450px;
        }
        
        .muscle-diagram-label {
            text-align: center;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text);
            font-size: 0.95rem;
            letter-spacing: 0.5px;
        }
        
        /* Muscle positions - Front */
        .muscle-chest { top: 18%; left: 25%; width: 50%; height: 20%; }
        .muscle-front-delts { top: 15%; left: 15%; width: 20%; height: 15%; }
        .muscle-front-delts.right { left: 65%; }
        .muscle-side-delts { top: 15%; left: 10%; width: 15%; height: 18%; }
        .muscle-side-delts.right { left: 75%; }
        .muscle-biceps { top: 28%; left: 12%; width: 15%; height: 18%; }
        .muscle-biceps.right { left: 73%; }
        .muscle-forearms { top: 48%; left: 10%; width: 15%; height: 20%; }
        .muscle-forearms.right { left: 75%; }
        .muscle-abs { top: 28%; left: 35%; width: 30%; height: 30%; }
        .muscle-obliques { top: 30%; left: 25%; width: 15%; height: 25%; }
        .muscle-obliques.right { left: 60%; }
        .muscle-quads { top: 58%; left: 28%; width: 20%; height: 32%; }
        .muscle-quads.right { left: 52%; }
        .muscle-calves-front { top: 85%; left: 30%; width: 18%; height: 13%; }
        .muscle-calves-front.right { left: 52%; }
        
        /* Muscle positions - Back */
        .muscle-traps { top: 10%; left: 30%; width: 40%; height: 18%; }
        .muscle-rear-delts { top: 15%; left: 15%; width: 18%; height: 15%; }
        .muscle-rear-delts.right { left: 67%; }
        .muscle-lats { top: 22%; left: 20%; width: 28%; height: 28%; }
        .muscle-lats.right { left: 52%; }
        .muscle-lower-back { top: 32%; left: 35%; width: 30%; height: 18%; }
        .muscle-triceps { top: 28%; left: 12%; width: 15%; height: 18%; }
        .muscle-triceps.right { left: 73%; }
        .muscle-forearms-back { top: 48%; left: 10%; width: 15%; height: 20%; }
        .muscle-forearms-back.right { left: 75%; }
        .muscle-glutes { top: 50%; left: 30%; width: 40%; height: 18%; }
        .muscle-hamstrings { top: 62%; left: 28%; width: 20%; height: 28%; }
        .muscle-hamstrings.right { left: 52%; }
        .muscle-calves-back { top: 85%; left: 30%; width: 18%; height: 13%; }
        .muscle-calves-back.right { left: 52%; }
        
        /* Settings Page */
        .settings-container {
            display: none;
            padding: 20px;
            animation: fadeIn 0.3s;
        }
        
        .settings-container.active {
            display: block;
        }
        
        .settings-header {
            margin-bottom: 30px;
        }
        
        .settings-header h2 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }
        
        .settings-section {
            background: var(--card);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .settings-section-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .settings-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .settings-option:last-child {
            border-bottom: none;
        }
        
        .settings-option-label {
            flex: 1;
        }
        
        .settings-option-label .title {
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .settings-option-label .description {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .settings-toggle {
            display: flex;
            gap: 10px;
        }
        
        .settings-toggle button {
            padding: 8px 20px;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            background: var(--card);
            color: var(--text-secondary);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .settings-toggle button.active {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-color: var(--primary);
            color: white;
        }
        
        .theme-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        .theme-option {
            padding: 20px;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .theme-option.active {
            border-color: var(--primary);
            box-shadow: 0 0 20px var(--primary-30);
        }
        
        .theme-preview {
            width: 100%;
            height: 60px;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .theme-name {
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        /* Custom Confirm Modal */
        .confirm-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }
        
        .confirm-modal.active {
            display: flex;
        }
        
        .confirm-dialog {
            background: var(--card);
            padding: 25px;
            border-radius: 20px;
            max-width: 320px;
            margin: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: scaleIn 0.3s ease-out;
        }
        
        @keyframes scaleIn {
            from {
                transform: scale(0.9);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .confirm-dialog h3 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--text);
        }
        
        .confirm-dialog p {
            color: var(--text-secondary);
            margin-bottom: 25px;
            line-height: 1.5;
        }
        
        .confirm-buttons {
            display: flex;
            gap: 12px;
        }
        
        .confirm-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .confirm-btn-cancel {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
        }
        
        .confirm-btn-cancel:active {
            transform: scale(0.95);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .confirm-btn-confirm {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
        }
        
        .confirm-btn-confirm:active {
            transform: scale(0.95);
        }
        
        /* Toast Notification */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: var(--dark);
            padding: 12px 24px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            z-index: 10000;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            white-space: nowrap;
            max-width: 90%;
        }
        
        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        /* Exercises Page */
        .exercises-container {
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
            padding-bottom: 100px;
        }
        
        .exercises-header {
            margin-bottom: 20px;
        }
        
        .exercises-header h2 {
            font-size: 1.8rem;
            margin-bottom: 8px;
        }
        
        .exercise-item {
            background: var(--card);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.3s;
        }
        
        .exercise-item:active {
            transform: scale(0.98);
        }
        
        .exercise-info {
            flex: 1;
        }
        
        .exercise-name {
            font-weight: 600;
            font-size: 1.05rem;
            margin-bottom: 4px;
        }
        
        .exercise-muscles {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .star-btn {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            padding: 8px;
            transition: transform 0.2s;
        }
        
        .star-btn:active {
            transform: scale(1.2);
        }
        
        .exercise-category {
            font-weight: 700;
            font-size: 0.9rem;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 25px 0 12px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--primary-30);
        }
    </style>
</head>
<body>
    <div class="bg-gradient"></div>
    
    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>
    
    <div class="header">
        <h1>GYMLOG</h1>
        <div class="date" id="currentDate"></div>
    </div>
    
    <div class="quick-stats">
        <div class="stat-card">
            <span class="value" id="totalWorkouts">0</span>
            <span class="label">Workouts</span>
        </div>
        <div class="stat-card">
            <span class="value" id="thisWeek">0</span>
            <span class="label">This Week</span>
        </div>
        <div class="stat-card">
            <span class="value" id="totalExercises">0</span>
            <span class="label">Exercises</span>
        </div>
    </div>
    
    <div class="container" id="mainContainer">
        <button class="log-workout-btn" onclick="openWorkoutModal()">
            + Log New Workout
        </button>
        
        <div class="section-header">
            <h2>Recent Workouts</h2>
        </div>
        
        <div class="workout-list" id="workoutList">
            <div class="empty-state">
                <div class="icon">ðŸ’ª</div>
                <p>No workouts logged yet.<br>Start your fitness journey!</p>
            </div>
        </div>
    </div>
    
    <!-- Log Workout Modal -->
    <div class="modal" id="workoutModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Log Workout</h2>
                <button class="close-btn" onclick="closeWorkoutModal()">Ã—</button>
            </div>
            
            <div class="form-group">
                <label>Workout Name</label>
                <input type="text" id="workoutName" placeholder="e.g., Morning Chest Day">
            </div>
            
            <div id="validationErrors"></div>
            
            <div class="form-group">
                <label>Exercise</label>
                <select id="exerciseSelect">
                    <option value="">Select an exercise</option>
                    <!-- Populated dynamically with favorite exercises -->
                </select>
            </div>
            
            <div id="currentExercises" style="max-height: 50vh; overflow-y: auto; margin-bottom: 15px;"></div>
            
            <button class="btn-secondary" onclick="addExercise()">+ Add Exercise</button>
            <button class="btn-primary" onclick="saveWorkout()">Save Workout</button>
        </div>
    </div>
    
    <!-- Settings Page -->
    <div class="settings-container" id="settingsContainer">
        <div class="settings-header">
            <h2>Settings</h2>
            <p style="color: var(--text-secondary);">Customize your workout experience</p>
        </div>
        
        <div class="settings-section">
            <div class="settings-section-title">Units</div>
            <div class="settings-option">
                <div class="settings-option-label">
                    <div class="title">Weight Measurement</div>
                    <div class="description">Choose your preferred weight unit</div>
                </div>
                <div class="settings-toggle">
                    <button id="unitKg" class="active" onclick="setWeightUnit('kg')">Kilograms (kg)</button>
                    <button id="unitLbs" onclick="setWeightUnit('lbs')">Pounds (lbs)</button>
                </div>
            </div>
        </div>
        
        <div class="settings-section">
            <div class="settings-section-title">Theme</div>
            <div class="theme-grid">
                <div class="theme-option active" id="themeDefault" onclick="setTheme('default')">
                    <div class="theme-preview" style="background: linear-gradient(135deg, #1c1c1e 0%, #000000 50%, #1a0505 100%);"></div>
                    <div class="theme-name">Dark Red</div>
                </div>
                <div class="theme-option" id="themeBlue" onclick="setTheme('blue')">
                    <div class="theme-preview" style="background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1e 50%, #16213e 100%);"></div>
                    <div class="theme-name">Navy Blue</div>
                </div>
                <div class="theme-option" id="themeGreen" onclick="setTheme('green')">
                    <div class="theme-preview" style="background: linear-gradient(135deg, #1a2e1a 0%, #0f1e0f 50%, #1e3a20 100%);"></div>
                    <div class="theme-name">Forest Green</div>
                </div>
                <div class="theme-option" id="themePurple" onclick="setTheme('purple')">
                    <div class="theme-preview" style="background: linear-gradient(135deg, #2e1a2e 0%, #1e0f1e 50%, #3a2040 100%);"></div>
                    <div class="theme-name">Deep Purple</div>
                </div>
                <div class="theme-option" id="themeOcean" onclick="setTheme('ocean')">
                    <div class="theme-preview" style="background: linear-gradient(135deg, #1a2a2e 0%, #0f1a1e 50%, #1a3540 100%);"></div>
                    <div class="theme-name">Ocean Teal</div>
                </div>
                <div class="theme-option" id="themeSunset" onclick="setTheme('sunset')">
                    <div class="theme-preview" style="background: linear-gradient(135deg, #2e1e1a 0%, #1e100f 50%, #3a2820 100%);"></div>
                    <div class="theme-name">Warm Sunset</div>
                </div>
                <div class="theme-option" id="themeCharcoal" onclick="setTheme('charcoal')">
                    <div class="theme-preview" style="background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 50%, #0a0a0a 100%);"></div>
                    <div class="theme-name">Charcoal</div>
                </div>
                <div class="theme-option" id="themeMidnight" onclick="setTheme('midnight')">
                    <div class="theme-preview" style="background: linear-gradient(135deg, #1a1a2a 0%, #0f0f1a 50%, #1a1a35 100%);"></div>
                    <div class="theme-name">Midnight</div>
                </div>
            </div>
        </div>
        
        <div class="settings-section">
            <div class="settings-section-title">Custom Exercises</div>
            <div class="settings-option">
                <div class="settings-option-label">
                    <div class="title">Your Custom Exercises</div>
                    <div class="description">Manage exercises you've created</div>
                </div>
            </div>
            <div id="customExercisesList" style="margin-top: 15px;"></div>
        </div>
        
        <div class="settings-section">
            <div class="settings-section-title">Install App</div>
            <div class="settings-option">
                <div class="settings-option-label">
                    <div class="title">Add to Home Screen</div>
                    <div class="description">Install GymLog for a native app experience</div>
                </div>
            </div>
            <div style="background: var(--card); padding: 20px; border-radius: 12px; margin-top: 15px; border: 1px solid rgba(255,255,255,0.1);">
                <div style="font-weight: 600; margin-bottom: 15px; color: var(--primary);">ðŸ“± iOS Instructions:</div>
                <ol style="padding-left: 20px; line-height: 1.8; color: var(--text-secondary); font-size: 0.9rem;">
                    <li>Tap the <strong style="color: var(--text);">Share</strong> button <span style="font-size: 1.2rem;">âŽ™</span> in Safari</li>
                    <li>Scroll down and tap <strong style="color: var(--text);">"Add to Home Screen"</strong> ðŸ“²</li>
                    <li>Tap <strong style="color: var(--text);">"Add"</strong> in the top right</li>
                    <li>Open GymLog from your home screen! âœ¨</li>
                </ol>
                <div style="margin-top: 15px; padding: 12px; background: rgba(255,59,48,0.1); border-radius: 8px; border-left: 3px solid var(--primary);">
                    <div style="font-size: 0.85rem; color: var(--text-secondary);">
                        ðŸ’¡ <strong style="color: var(--text);">Tip:</strong> Once installed, the app will run in fullscreen mode without the browser bars!
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Exercise Modal -->
    <div class="modal" id="addExerciseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Custom Exercise</h2>
                <button class="modal-close" onclick="closeAddExerciseModal()">Ã—</button>
            </div>
            
            <div class="form-group">
                <label>Exercise Name</label>
                <input type="text" id="newExerciseName" placeholder="e.g., Cable Fly, Hammer Curl" onkeypress="if(event.key === 'Enter') { event.preventDefault(); saveCustomExercise(); }">
            </div>
            
            <div class="form-group">
                <label>Target Muscles</label>
                <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 10px; width: 100%; direction: ltr; text-align: left;">
                    <label style="display: flex; align-items: center; gap: 8px; width: 100%; padding: 6px 0; direction: ltr; cursor: pointer;">
                        <input type="checkbox" value="chest" class="muscle-checkbox" style="flex-shrink: 0; width: 18px; height: 18px; margin: 0; cursor: pointer;"> 
                        <span style="user-select: none;">Chest (Pectorals)</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; width: 100%; padding: 6px 0; direction: ltr; cursor: pointer;">
                        <input type="checkbox" value="lats" class="muscle-checkbox" style="flex-shrink: 0; width: 18px; height: 18px; margin: 0; cursor: pointer;"> 
                        <span style="user-select: none;">Back (Lats)</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; width: 100%; padding: 6px 0; direction: ltr; cursor: pointer;">
                        <input type="checkbox" value="traps" class="muscle-checkbox" style="flex-shrink: 0; width: 18px; height: 18px; margin: 0; cursor: pointer;"> 
                        <span style="user-select: none;">Traps (Upper Back)</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; width: 100%; padding: 6px 0; direction: ltr; cursor: pointer;">
                        <input type="checkbox" value="lower-back" class="muscle-checkbox" style="flex-shrink: 0; width: 18px; height: 18px; margin: 0; cursor: pointer;"> 
                        <span style="user-select: none;">Lower Back</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; width: 100%; padding: 6px 0; direction: ltr; cursor: pointer;">
                        <input type="checkbox" value="front-delts" class="muscle-checkbox" style="flex-shrink: 0; width: 18px; height: 18px; margin: 0; cursor: pointer;"> 
                        <span style="user-select: none;">Front Shoulders</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; width: 100%; padding: 6px 0; direction: ltr; cursor: pointer;">
                        <input type="checkbox" value="side-delts" class="muscle-checkbox" style="flex-shrink: 0; width: 18px; height: 18px; margin: 0; cursor: pointer;"> 
                        <span style="user-select: none;">Side Shoulders</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; width: 100%; padding: 6px 0; direction: ltr; cursor: pointer;">
                        <input type="checkbox" value="rear-delts" class="muscle-checkbox" style="flex-shrink: 0; width: 18px; height: 18px; margin: 0; cursor: pointer;"> 
                        <span style="user-select: none;">Rear Shoulders</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; width: 100%; padding: 6px 0; direction: ltr; cursor: pointer;">
                        <input type="checkbox" value="biceps" class="muscle-checkbox" style="flex-shrink: 0; width: 18px; height: 18px; margin: 0; cursor: pointer;"> 
                        <span style="user-select: none;">Biceps</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; width: 100%; padding: 6px 0; direction: ltr; cursor: pointer;">
                        <input type="checkbox" value="triceps" class="muscle-checkbox" style="flex-shrink: 0; width: 18px; height: 18px; margin: 0; cursor: pointer;"> 
                        <span style="user-select: none;">Triceps</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; width: 100%; padding: 6px 0; direction: ltr; cursor: pointer;">
                        <input type="checkbox" value="forearms" class="muscle-checkbox" style="flex-shrink: 0; width: 18px; height: 18px; margin: 0; cursor: pointer;"> 
                        <span style="user-select: none;">Forearms</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; width: 100%; padding: 6px 0; direction: ltr; cursor: pointer;">
                        <input type="checkbox" value="abs" class="muscle-checkbox" style="flex-shrink: 0; width: 18px; height: 18px; margin: 0; cursor: pointer;"> 
                        <span style="user-select: none;">Abs (Core)</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; width: 100%; padding: 6px 0; direction: ltr; cursor: pointer;">
                        <input type="checkbox" value="obliques" class="muscle-checkbox" style="flex-shrink: 0; width: 18px; height: 18px; margin: 0; cursor: pointer;"> 
                        <span style="user-select: none;">Obliques (Side Core)</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; width: 100%; padding: 6px 0; direction: ltr; cursor: pointer;">
                        <input type="checkbox" value="quads" class="muscle-checkbox" style="flex-shrink: 0; width: 18px; height: 18px; margin: 0; cursor: pointer;"> 
                        <span style="user-select: none;">Quadriceps (Front Thigh)</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; width: 100%; padding: 6px 0; direction: ltr; cursor: pointer;">
                        <input type="checkbox" value="hamstrings" class="muscle-checkbox" style="flex-shrink: 0; width: 18px; height: 18px; margin: 0; cursor: pointer;"> 
                        <span style="user-select: none;">Hamstrings (Back Thigh)</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; width: 100%; padding: 6px 0; direction: ltr; cursor: pointer;">
                        <input type="checkbox" value="glutes" class="muscle-checkbox" style="flex-shrink: 0; width: 18px; height: 18px; margin: 0; cursor: pointer;"> 
                        <span style="user-select: none;">Glutes (Buttocks)</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 8px; width: 100%; padding: 6px 0; direction: ltr; cursor: pointer;">
                        <input type="checkbox" value="calves" class="muscle-checkbox" style="flex-shrink: 0; width: 18px; height: 18px; margin: 0; cursor: pointer;"> 
                        <span style="user-select: none;">Calves</span>
                    </label>
                </div>
            </div>
            
            <button class="btn-primary" onclick="saveCustomExercise()">Add Exercise</button>
        </div>
    </div>
    
    <!-- Exercises Library Page -->
    <div class="exercises-container" id="exercisesContainer" style="display: none;">
        <div class="exercises-header">
            <h2>Exercise Library</h2>
            <p style="color: var(--text-secondary); font-size: 0.95rem;">Mark your favorite exercises with a star</p>
        </div>
        
        <!-- Add Custom Exercise Button -->
        <button class="btn-primary" onclick="openAddExerciseModal()" style="width: 100%; margin-bottom: 20px;">
            + Add Custom Exercise
        </button>
        
        <!-- Search Bar -->
        <div class="search-bar" style="margin: 20px 0;">
            <input type="text" id="exerciseSearch" placeholder="ðŸ” Search exercises..." 
                   oninput="filterExercises()" 
                   style="width: 100%; padding: 12px 16px; background: var(--card); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; color: var(--text); font-size: 1rem;">
        </div>
        
        <!-- Exercise List -->
        <div id="exercisesList"></div>
    </div>
    
    <!-- Progress Analytics -->
    <div class="progress-container" id="progressContainer" style="display: none;">
        <div class="progress-header">
            <h2>Progress</h2>
            <p style="color: var(--text-secondary); font-size: 0.95rem;">Track your training data</p>
        </div>
        
        <!-- View Toggle Tabs -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">
            <button class="view-tab-btn active" onclick="setProgressView('chart')" data-view="chart">
                ðŸ“ˆ Exercise Progress
            </button>
            <button class="view-tab-btn" onclick="setProgressView('muscles')" data-view="muscles">
                ðŸ’ª Muscle Summary
            </button>
        </div>
        
        <!-- Exercise Progress View (Original) -->
        <div id="chartView">
            <div class="progress-controls">
                <div class="control-group">
                    <label>Select Exercise</label>
                    <select id="exerciseFilter" onchange="updateProgressChart()">
                        <option value="">Choose an exercise...</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label>Metric</label>
                    <div class="metric-toggle">
                        <button class="metric-btn active" id="weightBtn" onclick="setMetric('weight')">
                            <span id="weightBtnText">Weight (kg)</span>
                        </button>
                        <button class="metric-btn" id="repsBtn" onclick="setMetric('reps')">
                            Reps
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="chart-container" id="chartContainer">
                <div class="chart-title" id="chartTitle">Select an exercise to view progress</div>
                <div class="chart" id="chartArea">
                    <canvas id="progressChart" class="chart-canvas"></canvas>
                </div>
            </div>
            
            <div class="stats-grid" id="statsGrid" style="display: none;">
                <div class="stat-box">
                    <span class="value" id="maxValue">-</span>
                    <span class="label">Max</span>
                </div>
                <div class="stat-box">
                    <span class="value" id="avgValue">-</span>
                    <span class="label">Average</span>
                </div>
                <div class="stat-box">
                    <span class="value" id="totalSets">-</span>
                    <span class="label">Total Sets</span>
                </div>
                <div class="stat-box">
                    <span class="value" id="sessions">-</span>
                    <span class="label">Sessions</span>
                    <div class="trend up" id="trendIndicator" style="display: none;">
                        <span id="trendIcon">ðŸ“ˆ</span>
                        <span id="trendText">+0%</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Muscle Summary View (New) -->
        <div id="musclesView" style="display: none;">
            <!-- Time Period Selector -->
            <div style="margin-bottom: 20px;">
                <div class="time-period-buttons" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                    <button class="period-btn active" onclick="setTimePeriod('week')" data-period="week">
                        Week
                    </button>
                    <button class="period-btn" onclick="setTimePeriod('month')" data-period="month">
                        Month
                    </button>
                    <button class="period-btn" onclick="setTimePeriod('6months')" data-period="6months">
                        6 Months
                    </button>
                    <button class="period-btn" onclick="setTimePeriod('year')" data-period="year">
                        Year
                    </button>
                </div>
            </div>
            
            <!-- Summary Stats -->
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 25px;">
                <div style="background: var(--card); padding: 15px; border-radius: 12px; text-align: center; border: 1px solid rgba(255,255,255,0.1);">
                    <div style="font-size: 1.8rem; font-weight: 700; color: var(--primary);" id="totalWorkoutsPeriod">0</div>
                    <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 4px;">Total Workouts</div>
                </div>
                <div style="background: var(--card); padding: 15px; border-radius: 12px; text-align: center; border: 1px solid rgba(255,255,255,0.1);">
                    <div style="font-size: 1.8rem; font-weight: 700; color: var(--primary);" id="totalSetsPeriod">0</div>
                    <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 4px;">Total Sets</div>
                </div>
            </div>
            
            <!-- Muscle Summary List -->
            <div id="muscleSummaryList"></div>
        </div>
    </div>
    
    
    <!-- Workout Detail Modal -->
    <div class="workout-detail-modal" id="workoutDetailModal">
        <div class="detail-header">
            <div class="detail-header-top">
                <button class="back-btn" onclick="closeWorkoutDetail()">â†</button>
                <h2 id="detailWorkoutName">Workout Details</h2>
            </div>
            <div class="workout-meta" id="detailWorkoutMeta"></div>
        </div>
        <div class="detail-content" id="detailContent"></div>
    </div>
    
    <!-- Custom Confirm Modal -->
    <div class="confirm-modal" id="confirmModal">
        <div class="confirm-dialog">
            <h3 id="confirmTitle">Confirm</h3>
            <p id="confirmMessage">Are you sure?</p>
            <div class="confirm-buttons">
                <button class="confirm-btn confirm-btn-cancel" id="confirmCancel">Cancel</button>
                <button class="confirm-btn confirm-btn-confirm" id="confirmOk">Confirm</button>
            </div>
        </div>
    </div>
    
    <div class="bottom-nav">
        <a href="#" class="nav-item active" onclick="showTab('home'); return false;">
            <div class="icon">ðŸ </div>
            <span style="user-select: none;">Home</span>
        </a>
        <a href="#" class="nav-item" onclick="showTab('exercises'); return false;">
            <div class="icon">ðŸ’ª</div>
            <span style="user-select: none;">Exercises</span>
        </a>
        <a href="#" class="nav-item" onclick="showTab('progress'); return false;">
            <div class="icon">ðŸ“Š</div>
            <span style="user-select: none;">Progress</span>
        </a>
        <a href="#" class="nav-item" onclick="showTab('settings'); return false;">
            <div class="icon">âš™ï¸</div>
            <span style="user-select: none;">Settings</span>
        </a>
    </div>
    
    <script>
        // Global variables
        let workouts = [];
        let currentExercises = [];
        let customExercises = [];
        let favoriteExercises = []; // New: starred/favorite exercises
        let currentTimePeriod = 'week'; // For progress page
        
        let userSettings = {
            weightUnit: 'kg',
            theme: 'default'
        };
        
        // Muscle group descriptions
        const muscleDescriptions = {
            'chest': 'Pectorals - Front upper torso muscles',
            'triceps': 'Triceps - Back of upper arm (3 heads)',
            'biceps': 'Biceps - Front of upper arm (2 heads)',
            'front-delts': 'Front Deltoids - Front shoulder muscles',
            'side-delts': 'Side Deltoids - Side shoulder muscles',
            'rear-delts': 'Rear Deltoids - Back shoulder muscles',
            'quads': 'Quadriceps - Front thigh (4 muscles)',
            'hamstrings': 'Hamstrings - Back of thigh',
            'glutes': 'Glutes - Buttocks muscles',
            'calves': 'Calves - Lower leg (calf muscles)',
            'abs': 'Abs - Abdominal muscles (six-pack)',
            'obliques': 'Obliques - Side abs/core',
            'lats': 'Latissimus Dorsi - Large back muscles (wings)',
            'traps': 'Trapezius - Upper back/neck',
            'lower-back': 'Lower Back - Erector spinae',
            'forearms': 'Forearms - Lower arm muscles'
        };
        
        // Exercise to muscle groups mapping - comprehensive and accurate
        const exerciseToMuscleGroups = {
            // Chest
            'Bench Press': ['chest', 'front-delts', 'triceps'],
            'Incline Bench Press': ['chest', 'front-delts', 'triceps'],
            'Decline Bench Press': ['chest', 'front-delts', 'triceps'],
            'Dumbbell Bench Press': ['chest', 'front-delts', 'triceps'],
            'Dumbbell Flyes': ['chest', 'front-delts'],
            'Cable Flyes': ['chest', 'front-delts'],
            'Push-ups': ['chest', 'front-delts', 'triceps'],
            'Dips': ['chest', 'triceps', 'front-delts'],
            
            // Legs - Quads
            'Squat': ['quads', 'glutes', 'hamstrings'],
            'Front Squat': ['quads', 'glutes', 'abs'],
            'Leg Press': ['quads', 'glutes', 'hamstrings'],
            'Lunges': ['quads', 'glutes', 'hamstrings'],
            'Bulgarian Split Squat': ['quads', 'glutes', 'hamstrings'],
            'Leg Extension': ['quads'],
            'Hack Squat': ['quads', 'glutes'],
            
            // Legs - Hamstrings & Glutes
            'Deadlift': ['hamstrings', 'glutes', 'lower-back', 'lats', 'traps'],
            'Romanian Deadlift': ['hamstrings', 'glutes', 'lower-back'],
            'Sumo Deadlift': ['hamstrings', 'glutes', 'quads', 'lower-back'],
            'Leg Curl': ['hamstrings'],
            'Good Mornings': ['hamstrings', 'glutes', 'lower-back'],
            'Hip Thrust': ['glutes', 'hamstrings'],
            'Glute Bridge': ['glutes', 'hamstrings'],
            
            // Legs - Calves
            'Calf Raises': ['calves'],
            'Seated Calf Raises': ['calves'],
            
            // Back
            'Pull-ups': ['lats', 'biceps', 'rear-delts'],
            'Chin-ups': ['lats', 'biceps'],
            'Lat Pulldown': ['lats', 'biceps', 'rear-delts'],
            'Barbell Row': ['lats', 'rear-delts', 'biceps', 'traps'],
            'Dumbbell Row': ['lats', 'rear-delts', 'biceps'],
            'Seated Row': ['lats', 'rear-delts', 'biceps'],
            'T-Bar Row': ['lats', 'rear-delts', 'biceps', 'traps'],
            'Pendlay Row': ['lats', 'rear-delts', 'biceps', 'traps'],
            'Face Pulls': ['rear-delts', 'traps'],
            
            // Shoulders
            'Overhead Press': ['front-delts', 'side-delts', 'triceps'],
            'Military Press': ['front-delts', 'side-delts', 'triceps'],
            'Arnold Press': ['front-delts', 'side-delts', 'triceps'],
            'Lateral Raises': ['side-delts'],
            'Front Raises': ['front-delts'],
            'Rear Delt Flyes': ['rear-delts'],
            'Upright Row': ['side-delts', 'traps'],
            'Shrugs': ['traps'],
            
            // Arms - Biceps
            'Barbell Curl': ['biceps', 'forearms'],
            'Dumbbell Curl': ['biceps', 'forearms'],
            'Hammer Curl': ['biceps', 'forearms'],
            'Preacher Curl': ['biceps'],
            'Concentration Curl': ['biceps'],
            'Cable Curl': ['biceps', 'forearms'],
            'EZ Bar Curl': ['biceps', 'forearms'],
            
            // Arms - Triceps
            'Tricep Pushdown': ['triceps'],
            'Overhead Extension': ['triceps'],
            'Skull Crushers': ['triceps'],
            'Close Grip Bench': ['triceps', 'chest', 'front-delts'],
            'Diamond Push-ups': ['triceps', 'chest'],
            
            // Core
            'Plank': ['abs', 'obliques'],
            'Crunches': ['abs'],
            'Sit-ups': ['abs'],
            'Russian Twist': ['abs', 'obliques'],
            'Leg Raises': ['abs'],
            'Hanging Leg Raises': ['abs'],
            'Ab Wheel': ['abs'],
            'Cable Crunches': ['abs'],
            'Side Plank': ['obliques', 'abs'],
            'Bicycle Crunches': ['abs', 'obliques']
        };
        
        function updateDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateElement = document.getElementById('currentDate');
            if (dateElement) {
                dateElement.textContent = now.toLocaleDateString('en-US', options);
            }
        }
        
        function showToast(message) {
            const toast = document.getElementById('toast');
            if (!toast) {
                console.error('Toast element not found');
                alert(message); // Fallback to alert if toast is missing
                return;
            }
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
        
        function saveWorkoutsToStorage() {
            localStorage.setItem('gymWorkouts', JSON.stringify(workouts));
        }
        
        function loadWorkouts() {
            const saved = localStorage.getItem('gymWorkouts');
            if (saved) {
                workouts = JSON.parse(saved);
            }
            
            const savedCustom = localStorage.getItem('customExercises');
            if (savedCustom) {
                customExercises = JSON.parse(savedCustom);
                customExercises.forEach(ex => {
                    exerciseToMuscleGroups[ex.name] = ex.muscleGroups;
                });
                updateCustomExercisesDropdown();
            }
            
            updateStats();
            renderWorkouts();
        }
        
        function updateStats() {
            const totalWorkouts = workouts.length;
            const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
            const thisWeek = workouts.filter(w => new Date(w.date) >= weekAgo).length;
            const allExercises = new Set();
            workouts.forEach(w => w.exercises.forEach(e => allExercises.add(e.name)));
            
            const totalWorkoutsEl = document.getElementById('totalWorkouts');
            const thisWeekEl = document.getElementById('thisWeek');
            const totalExercisesEl = document.getElementById('totalExercises');
            
            if (totalWorkoutsEl) totalWorkoutsEl.textContent = totalWorkouts;
            if (thisWeekEl) thisWeekEl.textContent = thisWeek;
            if (totalExercisesEl) totalExercisesEl.textContent = allExercises.size;
        }
        
        function renderWorkouts() {
            const container = document.getElementById('workoutList');
            const workoutsWithIndices = workouts.map((w, index) => ({ workout: w, originalIndex: index }));
            workoutsWithIndices.sort((a, b) => new Date(b.workout.date) - new Date(a.workout.date));
            
            container.innerHTML = workoutsWithIndices.map(({ workout, originalIndex }) => {
                const date = new Date(workout.date);
                const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                const exercises = workout.exercises.map(e => e.name).join(', ');
                const totalSets = workout.exercises.reduce((sum, e) => sum + e.sets.length, 0);
                
                return `
                    <div class="workout-card" onclick="viewWorkoutDetails(${originalIndex})">
                        <div class="workout-header">
                            <div class="workout-date">${dateStr}</div>
                            <button class="delete-btn" onclick="event.stopPropagation(); deleteWorkout(${originalIndex})">Delete</button>
                        </div>
                        <div class="workout-exercises">${exercises}</div>
                        <div class="workout-summary">${totalSets} sets total</div>
                    </div>
                `;
            }).join('');
        }
        
        async function deleteWorkout(index) {
            if (await customConfirm('Delete Workout', 'Are you sure you want to delete this workout?')) {
                workouts.splice(index, 1);
                saveWorkoutsToStorage();
                updateStats();
                renderWorkouts();
                showToast('âœ… Workout deleted!');
            }
        }
        
        function customConfirm(title, message) {
            return new Promise((resolve) => {
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 400px;">
                        <h2>${title}</h2>
                        <p style="margin: 20px 0; color: var(--text-secondary);">${message}</p>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn-secondary" style="flex: 1;" onclick="this.closest('.modal').remove()">Cancel</button>
                            <button class="btn-primary" style="flex: 1;" id="confirmBtn">Confirm</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
                document.getElementById('confirmBtn').onclick = () => {
                    modal.remove();
                    resolve(true);
                };
                modal.onclick = (e) => {
                    if (e.target === modal) {
                        modal.remove();
                        resolve(false);
                    }
                };
            });
        }
        
        function openWorkoutModal() {
            currentExercises = [];
            renderCurrentExercises();
            document.getElementById('workoutModal').classList.add('active');
        }
        
        function closeWorkoutModal() {
            document.getElementById('workoutModal').classList.remove('active');
        }
        
        function addExercise() {
            const select = document.getElementById('exerciseSelect');
            const exerciseName = select.value;
            
            if (!exerciseName) {
                showToast('âš ï¸ Please select an exercise');
                return;
            }
            
            if (currentExercises.some(e => e.name === exerciseName)) {
                showToast('âš ï¸ This exercise is already in your workout!');
                return;
            }
            
            currentExercises.unshift({
                name: exerciseName,
                sets: [{ weight: '', reps: '' }]
            });
            
            renderCurrentExercises();
            const container = document.getElementById('currentExercises');
            container.scrollTop = 0;
        }
        
        function renderCurrentExercises() {
            const container = document.getElementById('currentExercises');
            const weightUnit = getWeightUnit();
            
            container.innerHTML = currentExercises.map((exercise, exIndex) => `
                <div class="exercise-entry">
                    <div class="entry-header">
                        <span class="exercise-name">${exercise.name}</span>
                        <button class="remove-exercise" onclick="removeExercise(${exIndex})">Ã—</button>
                    </div>
                    <div class="sets-container">
                        ${exercise.sets.map((set, setIndex) => `
                            <div class="set-row">
                                <span class="set-number">Set ${setIndex + 1}</span>
                                <input type="number" placeholder="Weight (${weightUnit})" value="${set.weight}" 
                                       onchange="updateSet(${exIndex}, ${setIndex}, 'weight', this.value)">
                                <input type="number" placeholder="Reps" value="${set.reps}" 
                                       onchange="updateSet(${exIndex}, ${setIndex}, 'reps', this.value)">
                                ${exercise.sets.length > 1 ? 
                                    `<button class="remove-exercise" onclick="removeSet(${exIndex}, ${setIndex})">Ã—</button>` : 
                                    '<span style="user-select: none;"></span>'}
                            </div>
                        `).join('')}
                    </div>
                    <button class="add-set-btn" onclick="addSet(${exIndex})">+ Add Set</button>
                </div>
            `).join('');
            
            updateExerciseDropdown();
        }
        
        function updateExerciseDropdown() {
            const select = document.getElementById('exerciseSelect');
            if (!select) return;
            
            const currentNames = currentExercises.map(e => e.name);
            
            // Build categories dynamically with only favorite exercises
            const categories = {
                'Chest': [],
                'Back': [],
                'Shoulders': [],
                'Arms': [],
                'Legs': [],
                'Core': [],
                'Custom': []
            };
            
            // Filter only favorite exercises and categorize them by muscle groups
            favoriteExercises.forEach(exerciseName => {
                // Skip if already added to current workout
                if (currentNames.includes(exerciseName)) return;
                
                // Get muscles for this exercise
                const muscles = exerciseToMuscleGroups[exerciseName] || [];
                
                // Categorize based on primary muscle
                if (muscles.includes('chest')) {
                    categories['Chest'].push(exerciseName);
                } else if (muscles.includes('lats') || muscles.includes('traps') || muscles.includes('lower-back')) {
                    categories['Back'].push(exerciseName);
                } else if (muscles.includes('front-delts') || muscles.includes('side-delts') || muscles.includes('rear-delts')) {
                    categories['Shoulders'].push(exerciseName);
                } else if (muscles.includes('biceps') || muscles.includes('triceps') || muscles.includes('forearms')) {
                    categories['Arms'].push(exerciseName);
                } else if (muscles.includes('quads') || muscles.includes('hamstrings') || muscles.includes('glutes') || muscles.includes('calves')) {
                    categories['Legs'].push(exerciseName);
                } else if (muscles.includes('abs') || muscles.includes('obliques')) {
                    categories['Core'].push(exerciseName);
                } else {
                    // If no muscles defined, put in Custom
                    categories['Custom'].push(exerciseName);
                }
            });
            
            // Build HTML
            let html = '<option value="">Select an exercise</option>';
            
            for (const [category, exercises] of Object.entries(categories)) {
                if (exercises.length === 0) continue;
                
                html += `<optgroup label="${category}">`;
                exercises.sort().forEach(exercise => {
                    html += `<option value="${exercise}">${exercise}</option>`;
                });
                html += '</optgroup>';
            }
            
            select.innerHTML = html;
        }
        
        function removeExercise(index) {
            currentExercises.splice(index, 1);
            renderCurrentExercises();
        }
        
        function updateSet(exIndex, setIndex, field, value) {
            currentExercises[exIndex].sets[setIndex][field] = value;
        }
        
        function addSet(exIndex) {
            currentExercises[exIndex].sets.push({ weight: '', reps: '' });
            renderCurrentExercises();
        }
        
        function removeSet(exIndex, setIndex) {
            currentExercises[exIndex].sets.splice(setIndex, 1);
            renderCurrentExercises();
        }
        
        function saveWorkout() {
            if (currentExercises.length === 0) {
                showToast('âš ï¸ Add at least one exercise');
                return;
            }
            
            const now = new Date();
            const workout = {
                date: now.toISOString(),
                name: now.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' }) + ' Workout',
                exercises: currentExercises
            };
            
            workouts.push(workout);
            saveWorkoutsToStorage();
            updateStats();
            renderWorkouts();
            closeWorkoutModal();
            showToast('âœ… Workout saved!');
        }
        
        function viewWorkoutDetails(index) {
            const workout = workouts[index];
            if (!workout) return;
            
            const date = new Date(workout.date);
            const dateStr = date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
            const timeStr = date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            
            let totalSets = 0;
            let totalReps = 0;
            
            workout.exercises.forEach(ex => {
                totalSets += ex.sets.length;
                ex.sets.forEach(set => {
                    totalReps += parseInt(set.reps) || 0;
                });
            });
            
            const activeMuscleGroups = getMuscleGroupsFromWorkout(workout);
            
            const nameElement = document.getElementById('detailWorkoutName');
            const metaElement = document.getElementById('detailWorkoutMeta');
            
            if (nameElement) {
                nameElement.textContent = workout.name || 'Workout Session';
            }
            if (metaElement) {
                metaElement.textContent = `${dateStr} at ${timeStr}`;
            }
            
            let contentHtml = `
                <div class="workout-summary">
                    <h3>Workout Summary</h3>
                    <div class="summary-stats">
                        <div class="summary-stat">
                            <span class="value">${workout.exercises.length}</span>
                            <span class="label">Exercises</span>
                        </div>
                        <div class="summary-stat">
                            <span class="value">${totalSets}</span>
                            <span class="label">Total Sets</span>
                        </div>
                        <div class="summary-stat">
                            <span class="value">${totalReps}</span>
                            <span class="label">Total Reps</span>
                        </div>
                    </div>
                </div>
            `;
            
            workout.exercises.forEach(ex => {
                contentHtml += `
                    <div class="exercise-detail">
                        <div class="exercise-detail-header">
                            <div class="exercise-detail-name">${ex.name}</div>
                            <div class="exercise-detail-sets-count">${ex.sets.length} Sets</div>
                        </div>
                        <div class="sets-detail-list">
                            ${ex.sets.map((set, setIndex) => `
                                <div class="set-detail-row">
                                    <div class="set-detail-number">Set ${setIndex + 1}</div>
                                    <div class="set-detail-values">
                                        <div class="set-detail-value">
                                            <span class="label">Weight</span>
                                            <span class="value">${formatWeight(set.weight)}</span>
                                        </div>
                                        <div class="set-detail-value">
                                            <span class="label">Reps</span>
                                            <span class="value">${set.reps}</span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            
            contentHtml += generateMuscleDiagram(activeMuscleGroups);
            
            const contentElement = document.getElementById('detailContent');
            if (contentElement) {
                contentElement.innerHTML = contentHtml;
            }
            
            const modalElement = document.getElementById('workoutDetailModal');
            if (modalElement) {
                modalElement.classList.add('active');
            }
        }
        
        function getMuscleGroupsFromWorkout(workout) {
            const muscleGroups = new Set();
            if (workout && Array.isArray(workout.exercises)) {
                workout.exercises.forEach(exercise => {
                    const groups = exerciseToMuscleGroups[exercise.name];
                    if (groups) {
                        groups.forEach(group => muscleGroups.add(group));
                    }
                });
            }
            return Array.from(muscleGroups);
        }
        
        function generateMuscleDiagram(activeMuscles) {
            const muscleLabels = {
                'chest': 'Chest',
                'triceps': 'Triceps',
                'biceps': 'Biceps',
                'front-delts': 'Front Shoulders',
                'side-delts': 'Side Shoulders',
                'rear-delts': 'Rear Shoulders',
                'quads': 'Quadriceps',
                'hamstrings': 'Hamstrings',
                'glutes': 'Glutes',
                'calves': 'Calves',
                'abs': 'Abs',
                'obliques': 'Obliques',
                'lats': 'Lats',
                'traps': 'Traps',
                'lower-back': 'Lower Back',
                'forearms': 'Forearms'
            };
            
            if (activeMuscles.length === 0) {
                return '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">No muscle data</div>';
            }
            
            return `
                <div style="margin-top: 30px; padding: 20px; background: rgba(255,255,255,0.03); border-radius: 12px;">
                    <h3 style="margin-bottom: 15px;">Muscles Trained</h3>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        ${activeMuscles.map(muscle => `
                            <div onclick="toggleMuscleInfo('${muscle}')" style="padding: 12px; background: var(--primary-20); border-radius: 8px; border: 1px solid var(--primary-30); cursor: pointer; transition: all 0.3s;">
                                <div style="display: flex; align-items: center; justify-content: space-between;">
                                    <div>
                                        <span style="color: var(--primary); font-weight: 600;">âœ“</span>
                                        <span style="margin-left: 8px; font-weight: 600;">${muscleLabels[muscle] || muscle}</span>
                                    </div>
                                    <span id="muscle-arrow-${muscle}" style="color: var(--text-secondary); font-size: 0.8rem;">â–¼</span>
                                </div>
                                <div id="muscle-info-${muscle}" style="display: none; margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1); color: var(--text-secondary); font-size: 0.85rem;">
                                    ${muscleDescriptions[muscle] || 'Muscle description'}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        function toggleMuscleInfo(muscleId) {
            const info = document.getElementById('muscle-info-' + muscleId);
            const arrow = document.getElementById('muscle-arrow-' + muscleId);
            
            if (info.style.display === 'none') {
                info.style.display = 'block';
                arrow.textContent = 'â–²';
            } else {
                info.style.display = 'none';
                arrow.textContent = 'â–¼';
            }
        }
        
        function closeWorkoutDetail() {
            document.getElementById('workoutDetailModal').classList.remove('active');
        }
        
        function showTab(tab) {
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event.target.closest('.nav-item').classList.add('active');
            
            const mainContainer = document.getElementById('mainContainer');
            const exercisesContainer = document.getElementById('exercisesContainer');
            const progressContainer = document.getElementById('progressContainer');
            const settingsContainer = document.getElementById('settingsContainer');
            const quickStats = document.querySelector('.quick-stats');
            
            // Hide all
            if (mainContainer) mainContainer.style.display = 'none';
            if (exercisesContainer) exercisesContainer.style.display = 'none';
            if (progressContainer) progressContainer.style.display = 'none';
            if (settingsContainer) settingsContainer.style.display = 'none';
            
            // Show selected
            if (tab === 'home') {
                if (mainContainer) mainContainer.style.display = 'block';
                if (quickStats) quickStats.style.display = 'grid';
            } else if (tab === 'exercises') {
                if (exercisesContainer) exercisesContainer.style.display = 'block';
                if (quickStats) quickStats.style.display = 'none';
                renderExercisesLibrary();
            } else if (tab === 'progress') {
                if (progressContainer) progressContainer.style.display = 'block';
                if (quickStats) quickStats.style.display = 'none';
                populateExerciseFilter(); // Populate exercise dropdown
                updateMuscleSummary(); // Update muscle summary when opening
            } else if (tab === 'settings') {
                if (settingsContainer) settingsContainer.style.display = 'block';
                if (quickStats) quickStats.style.display = 'none';
                renderCustomExercises();
            }
        }
        
        // Load/Save favorite exercises
        function loadFavorites() {
            const saved = localStorage.getItem('favoriteExercises');
            if (saved) {
                favoriteExercises = JSON.parse(saved);
            } else {
                // Default: all exercises are favorites initially
                favoriteExercises = Object.keys(exerciseToMuscleGroups);
            }
        }
        
        function saveFavorites() {
            localStorage.setItem('favoriteExercises', JSON.stringify(favoriteExercises));
        }
        
        function toggleFavorite(exerciseName) {
            const index = favoriteExercises.indexOf(exerciseName);
            if (index > -1) {
                favoriteExercises.splice(index, 1);
            } else {
                favoriteExercises.push(exerciseName);
            }
            saveFavorites();
            renderExercisesLibrary();
            updateExerciseDropdownWithFavorites();
        }
        
        function renderExercisesLibrary() {
            const container = document.getElementById('exercisesList');
            if (!container) return;
            
            const allExercises = Object.keys(exerciseToMuscleGroups);
            
            // Categorize based on primary muscle group
            const categories = {
                'Chest': [],
                'Back': [],
                'Shoulders': [],
                'Arms': [],
                'Legs': [],
                'Core': [],
                'Custom': []
            };
            
            allExercises.forEach(exercise => {
                const muscles = exerciseToMuscleGroups[exercise] || [];
                
                // Categorize by primary muscle (first in the list or most prominent)
                if (muscles.includes('chest')) {
                    categories['Chest'].push(exercise);
                } else if (muscles.includes('lats') || muscles.includes('traps') || muscles.includes('lower-back')) {
                    categories['Back'].push(exercise);
                } else if (muscles.includes('front-delts') || muscles.includes('side-delts') || muscles.includes('rear-delts')) {
                    categories['Shoulders'].push(exercise);
                } else if (muscles.includes('biceps') || muscles.includes('triceps') || muscles.includes('forearms')) {
                    categories['Arms'].push(exercise);
                } else if (muscles.includes('quads') || muscles.includes('hamstrings') || muscles.includes('glutes') || muscles.includes('calves')) {
                    categories['Legs'].push(exercise);
                } else if (muscles.includes('abs') || muscles.includes('obliques')) {
                    categories['Core'].push(exercise);
                }
            });
            
            // Add custom exercises to their category
            customExercises.forEach(ex => {
                const muscles = ex.muscleGroups || [];
                
                // Add to appropriate category based on muscles
                if (muscles.includes('chest')) {
                    categories['Chest'].push(ex.name);
                } else if (muscles.includes('lats') || muscles.includes('traps') || muscles.includes('lower-back')) {
                    categories['Back'].push(ex.name);
                } else if (muscles.includes('front-delts') || muscles.includes('side-delts') || muscles.includes('rear-delts')) {
                    categories['Shoulders'].push(ex.name);
                } else if (muscles.includes('biceps') || muscles.includes('triceps') || muscles.includes('forearms')) {
                    categories['Arms'].push(ex.name);
                } else if (muscles.includes('quads') || muscles.includes('hamstrings') || muscles.includes('glutes') || muscles.includes('calves')) {
                    categories['Legs'].push(ex.name);
                } else if (muscles.includes('abs') || muscles.includes('obliques')) {
                    categories['Core'].push(ex.name);
                } else {
                    categories['Custom'].push(ex.name);
                }
            });
            
            let html = '';
            for (const [category, exercises] of Object.entries(categories)) {
                if (exercises.length === 0) continue;
                
                html += `<div class="exercise-category">${category}</div>`;
                exercises.forEach(exercise => {
                    const isFavorite = favoriteExercises.includes(exercise);
                    const muscles = exerciseToMuscleGroups[exercise] || [];
                    const muscleText = muscles.map(m => {
                        return m.replace('-', ' ').split(' ').map(word => 
                            word.charAt(0).toUpperCase() + word.slice(1)
                        ).join(' ');
                    }).join(', ');
                    
                    html += `
                        <div class="exercise-item">
                            <div class="exercise-info">
                                <div class="exercise-name">${exercise}</div>
                                <div class="exercise-muscles">${muscleText}</div>
                            </div>
                            <button class="star-btn" onclick="toggleFavorite('${exercise}')">
                                ${isFavorite ? 'â­' : 'â˜†'}
                            </button>
                        </div>
                    `;
                });
            }
            
            container.innerHTML = html;
        }
        
        function filterExercises() {
            const searchInput = document.getElementById('exerciseSearch');
            if (!searchInput) return;
            
            const query = searchInput.value.toLowerCase();
            const items = document.querySelectorAll('.exercise-item');
            const categories = document.querySelectorAll('.exercise-category');
            
            items.forEach(item => {
                const name = item.querySelector('.exercise-name').textContent.toLowerCase();
                const muscles = item.querySelector('.exercise-muscles').textContent.toLowerCase();
                
                if (name.includes(query) || muscles.includes(query)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
            
            // Hide empty categories
            categories.forEach(cat => {
                let nextElement = cat.nextElementSibling;
                let hasVisibleExercises = false;
                
                while (nextElement && !nextElement.classList.contains('exercise-category')) {
                    if (nextElement.style.display !== 'none') {
                        hasVisibleExercises = true;
                        break;
                    }
                    nextElement = nextElement.nextElementSibling;
                }
                
                cat.style.display = hasVisibleExercises ? 'block' : 'none';
            });
        }
        
        function updateExerciseDropdownWithFavorites() {
            // Rebuild the dropdown with current favorites
            updateExerciseDropdown();
        }
        
        // Progress - Time Period and Muscle Summary
        function setTimePeriod(period) {
            currentTimePeriod = period;
            
            // Update button states
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-period="${period}"]`).classList.add('active');
            
            // Update summary
            updateMuscleSummary();
        }
        
        function updateMuscleSummary() {
            const now = new Date();
            let startDate;
            
            // Calculate start date based on period
            switch(currentTimePeriod) {
                case 'week':
                    startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                    break;
                case 'month':
                    startDate = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
                    break;
                case '6months':
                    startDate = new Date(now.getTime() - 180 * 24 * 60 * 60 * 1000);
                    break;
                case 'year':
                    startDate = new Date(now.getTime() - 365 * 24 * 60 * 60 * 1000);
                    break;
                default:
                    startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
            }
            
            // Filter workouts in period
            const workoutsInPeriod = workouts.filter(w => new Date(w.date) >= startDate);
            
            // Calculate muscle stats
            const muscleStats = {};
            let totalSets = 0;
            
            workoutsInPeriod.forEach(workout => {
                workout.exercises.forEach(exercise => {
                    const muscles = exerciseToMuscleGroups[exercise.name] || [];
                    const setsCount = exercise.sets.length;
                    totalSets += setsCount;
                    
                    muscles.forEach(muscle => {
                        if (!muscleStats[muscle]) {
                            muscleStats[muscle] = {
                                sets: 0,
                                exercises: new Set()
                            };
                        }
                        muscleStats[muscle].sets += setsCount;
                        muscleStats[muscle].exercises.add(exercise.name);
                    });
                });
            });
            
            // Update summary stats
            const totalWorkoutsEl = document.getElementById('totalWorkoutsPeriod');
            const totalSetsEl = document.getElementById('totalSetsPeriod');
            if (totalWorkoutsEl) totalWorkoutsEl.textContent = workoutsInPeriod.length;
            if (totalSetsEl) totalSetsEl.textContent = totalSets;
            
            // Render muscle list
            renderMuscleSummary(muscleStats, totalSets);
        }
        
        function renderMuscleSummary(muscleStats, totalSets) {
            const container = document.getElementById('muscleSummaryList');
            if (!container) return;
            
            // Convert to array and sort by sets count
            const muscleArray = Object.entries(muscleStats).map(([muscle, stats]) => ({
                muscle,
                sets: stats.sets,
                exercisesCount: stats.exercises.size,
                exercises: Array.from(stats.exercises)
            })).sort((a, b) => b.sets - a.sets);
            
            if (muscleArray.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                        <div style="font-size: 3rem; margin-bottom: 15px;">ðŸ’ª</div>
                        <div style="font-size: 1.1rem; margin-bottom: 8px;">No workouts in this period</div>
                        <div style="font-size: 0.9rem;">Start training to see your progress!</div>
                    </div>
                `;
                return;
            }
            
            const muscleLabels = {
                'chest': 'Chest',
                'triceps': 'Triceps',
                'biceps': 'Biceps',
                'front-delts': 'Front Shoulders',
                'side-delts': 'Side Shoulders',
                'rear-delts': 'Rear Shoulders',
                'quads': 'Quadriceps',
                'hamstrings': 'Hamstrings',
                'glutes': 'Glutes',
                'calves': 'Calves',
                'abs': 'Abs',
                'obliques': 'Obliques',
                'lats': 'Lats',
                'traps': 'Traps',
                'lower-back': 'Lower Back',
                'forearms': 'Forearms'
            };
            
            let html = '';
            muscleArray.forEach(item => {
                const muscleName = muscleLabels[item.muscle] || item.muscle;
                
                html += `
                    <div class="muscle-summary-item">
                        <div class="muscle-name">${muscleName}</div>
                        <div class="muscle-sets-count">${item.sets} sets</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Progress view toggle
        function setProgressView(view) {
            // Update button states
            document.querySelectorAll('.view-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-view="${view}"]`).classList.add('active');
            
            // Show/hide views
            const chartView = document.getElementById('chartView');
            const musclesView = document.getElementById('musclesView');
            
            if (view === 'chart') {
                if (chartView) chartView.style.display = 'block';
                if (musclesView) musclesView.style.display = 'none';
            } else {
                if (chartView) chartView.style.display = 'none';
                if (musclesView) musclesView.style.display = 'block';
                updateMuscleSummary(); // Update when switching to muscles view
            }
        }
        
        // Populate exercise filter dropdown with all exercises from workouts
        function populateExerciseFilter() {
            const select = document.getElementById('exerciseFilter');
            if (!select) return;
            
            // Get all unique exercises from workouts
            const exerciseSet = new Set();
            workouts.forEach(workout => {
                workout.exercises.forEach(exercise => {
                    exerciseSet.add(exercise.name);
                });
            });
            
            // Sort alphabetically
            const exercises = Array.from(exerciseSet).sort();
            
            // Build HTML
            let html = '<option value="">Choose an exercise...</option>';
            exercises.forEach(exercise => {
                html += `<option value="${exercise}">${exercise}</option>`;
            });
            
            select.innerHTML = html;
        }
        
        // Placeholder for chart update (you can implement this if you want)
        let currentMetric = 'weight';
        
        function updateProgressChart() {
            const select = document.getElementById('exerciseFilter');
            if (!select) return;
            
            const exerciseName = select.value;
            const chartArea = document.getElementById('chartArea');
            
            if (!exerciseName) {
                // No exercise selected
                const chartTitle = document.getElementById('chartTitle');
                if (chartTitle) chartTitle.textContent = 'Select an exercise to view progress';
                if (chartArea) chartArea.innerHTML = '<canvas id="progressChart" class="chart-canvas"></canvas>';
                const statsGrid = document.getElementById('statsGrid');
                if (statsGrid) statsGrid.style.display = 'none';
                return;
            }
            
            // Get data for this exercise
            if (currentMetric === 'weight') {
                updateWeightChart(exerciseName);
            } else {
                updateRepsChart(exerciseName);
            }
        }
        
        function updateWeightChart(exerciseName) {
            const chartArea = document.getElementById('chartArea');
            
            // Get data - group by workout session
            const sessionData = [];
            workouts.forEach(workout => {
                const exercise = workout.exercises.find(ex => ex.name === exerciseName);
                if (exercise && exercise.sets.length > 0) {
                    const date = new Date(workout.date);
                    const weights = exercise.sets.map(s => parseFloat(s.weight) || 0).filter(w => w > 0);
                    
                    if (weights.length > 0) {
                        sessionData.push({
                            date: date,
                            weight: Math.max(...weights),
                            setsCount: exercise.sets.length
                        });
                    }
                }
            });
            
            sessionData.sort((a, b) => a.date - b.date);
            
            const chartTitle = document.getElementById('chartTitle');
            if (chartTitle) {
                chartTitle.textContent = `${exerciseName} - Max Weight Progress`;
            }
            
            if (sessionData.length > 0) {
                const weights = sessionData.map(d => d.weight);
                const maxWeight = Math.max(...weights);
                const avgWeight = weights.reduce((a, b) => a + b, 0) / weights.length;
                const totalSets = sessionData.reduce((sum, d) => sum + d.setsCount, 0);
                
                const maxValueEl = document.getElementById('maxValue');
                const avgValueEl = document.getElementById('avgValue');
                const totalSetsEl = document.getElementById('totalSets');
                const sessionsEl = document.getElementById('sessions');
                const statsGrid = document.getElementById('statsGrid');
                
                if (maxValueEl) maxValueEl.textContent = formatWeight(maxWeight);
                if (avgValueEl) avgValueEl.textContent = formatWeight(avgWeight.toFixed(1));
                if (totalSetsEl) totalSetsEl.textContent = totalSets;
                if (sessionsEl) sessionsEl.textContent = sessionData.length;
                if (statsGrid) statsGrid.style.display = 'grid';
                
                drawWeightChart(sessionData);
            } else {
                if (chartArea) {
                    chartArea.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-secondary);">No data for this exercise yet</div>';
                }
            }
        }
        
        function updateRepsChart(exerciseName) {
            const chartArea = document.getElementById('chartArea');
            
            
            // Collect all sets with weight and reps
            const allSets = [];
            workouts.forEach(workout => {
                const exercise = workout.exercises.find(ex => ex.name === exerciseName);
                if (exercise) {
                    const date = new Date(workout.date);
                    exercise.sets.forEach(set => {
                        const weight = parseFloat(set.weight) || 0;
                        const reps = parseInt(set.reps) || 0;
                        if (weight > 0 && reps > 0) {
                            allSets.push({ date, weight, reps });
                        }
                    });
                }
            });
            
            
            if (allSets.length === 0) {
                if (chartArea) {
                    chartArea.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-secondary);">No rep data available - add some workouts first!</div>';
                }
                const statsGrid = document.getElementById('statsGrid');
                if (statsGrid) statsGrid.style.display = 'none';
                return;
            }
            
            // Group by exact weight
            const exactWeightGroups = {};
            allSets.forEach(set => {
                const exactWeight = set.weight;
                if (!exactWeightGroups[exactWeight]) {
                    exactWeightGroups[exactWeight] = [];
                }
                exactWeightGroups[exactWeight].push(set);
            });
            
            // Also try rounded weights (2.5kg) for grouping similar weights
            const roundedGroups = {};
            allSets.forEach(set => {
                const roundedWeight = Math.round(set.weight / 2.5) * 2.5;
                if (!roundedGroups[roundedWeight]) {
                    roundedGroups[roundedWeight] = [];
                }
                roundedGroups[roundedWeight].push(set);
            });
            
            
            // Collect all weights that have 2+ sets (prefer exact, then rounded)
            const weightsWithProgress = [];
            
            // First, add exact weights with 2+ sets
            Object.entries(exactWeightGroups).forEach(([weight, sets]) => {
                if (sets.length >= 2) {
                    weightsWithProgress.push({
                        weight: parseFloat(weight),
                        sets: sets.sort((a, b) => a.date - b.date),
                        isExact: true
                    });
                }
            });
            
            // Then add rounded weights that don't overlap with exact ones
            Object.entries(roundedGroups).forEach(([weight, sets]) => {
                if (sets.length >= 2) {
                    const w = parseFloat(weight);
                    // Check if we already have this weight from exact matches
                    const hasExact = weightsWithProgress.some(item => Math.abs(item.weight - w) < 1);
                    if (!hasExact) {
                        weightsWithProgress.push({
                            weight: w,
                            sets: sets.sort((a, b) => a.date - b.date),
                            isExact: false
                        });
                    }
                }
            });
            
            
            if (weightsWithProgress.length === 0) {
                if (chartArea) {
                    chartArea.innerHTML = `
                        <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
                            <div style="margin-bottom: 10px;">ðŸ“Š</div>
                            <div>Not enough data to show progress</div>
                            <div style="font-size: 0.85rem; margin-top: 8px;">Use the same weight in multiple sessions to see progress</div>
                        </div>
                    `;
                }
                const statsGrid = document.getElementById('statsGrid');
                if (statsGrid) statsGrid.style.display = 'none';
                return;
            }
            
            // Sort by weight (descending)
            weightsWithProgress.sort((a, b) => b.weight - a.weight);
            
            // Update title
            const chartTitle = document.getElementById('chartTitle');
            if (chartTitle) {
                chartTitle.textContent = `${exerciseName} - Reps Progress by Weight`;
            }
            
            // Calculate overall stats
            const allReps = allSets.map(s => s.reps);
            const maxReps = Math.max(...allReps);
            const avgReps = (allReps.reduce((a, b) => a + b, 0) / allReps.length).toFixed(1);
            const uniqueDates = new Set(allSets.map(s => s.date.toDateString()));
            
            const maxValueEl = document.getElementById('maxValue');
            const avgValueEl = document.getElementById('avgValue');
            const totalSetsEl = document.getElementById('totalSets');
            const sessionsEl = document.getElementById('sessions');
            const statsGrid = document.getElementById('statsGrid');
            
            if (maxValueEl) maxValueEl.textContent = `${maxReps} reps`;
            if (avgValueEl) avgValueEl.textContent = `${avgReps} reps`;
            if (totalSetsEl) totalSetsEl.textContent = allSets.length;
            if (sessionsEl) sessionsEl.textContent = uniqueDates.size;
            if (statsGrid) statsGrid.style.display = 'grid';
            
            // Draw all weight progressions
            drawAllRepsCharts(weightsWithProgress);
        }
        
        function drawAllRepsCharts(weightsWithProgress) {
            const chartArea = document.getElementById('chartArea');
            if (!chartArea) return;
            
            let html = '<div style="display: flex; flex-direction: column; gap: 20px;">';
            
            weightsWithProgress.forEach(weightData => {
                const sets = weightData.sets;
                const weight = weightData.weight;
                
                // Calculate range for this weight
                const reps = sets.map(s => s.reps);
                const maxReps = Math.max(...reps);
                const minReps = Math.min(...reps);
                const range = maxReps - minReps || 1;
                
                html += `
                    <div style="background: rgba(255,255,255,0.03); padding: 15px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);">
                        <div style="font-weight: 700; font-size: 1.05rem; margin-bottom: 12px; color: var(--primary);">
                            ${formatWeight(weight)}
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 6px;">
                `;
                
                sets.forEach((set, index) => {
                    const value = set.reps;
                    const percentage = ((value - minReps) / range) * 100;
                    const dateStr = set.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    
                    html += `
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="min-width: 50px; font-size: 0.75rem; color: var(--text-secondary);">${dateStr}</div>
                            <div style="flex: 1; background: rgba(255,255,255,0.05); border-radius: 6px; height: 26px; position: relative; overflow: hidden;">
                                <div style="height: 100%; background: linear-gradient(90deg, var(--primary), var(--accent)); border-radius: 6px; width: ${Math.max(percentage, 5)}%; transition: width 0.5s ease;"></div>
                                <div style="position: absolute; top: 50%; left: 8px; transform: translateY(-50%); font-weight: 600; font-size: 0.8rem; color: white; text-shadow: 0 1px 3px rgba(0,0,0,0.5);">
                                    ${value} reps
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            chartArea.innerHTML = html;
        }
        
        function drawWeightChart(data) {
            const chartArea = document.getElementById('chartArea');
            if (!chartArea || data.length === 0) return;
            
            const values = data.map(d => d.weight);
            const maxValue = Math.max(...values);
            const minValue = Math.min(...values);
            const range = maxValue - minValue || 1;
            
            let html = '<div style="display: flex; flex-direction: column; gap: 8px;">';
            
            data.forEach((session, index) => {
                const value = session.weight;
                const percentage = ((value - minValue) / range) * 100;
                const dateStr = session.date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                const displayValue = formatWeight(value);
                
                html += `
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="min-width: 50px; font-size: 0.75rem; color: var(--text-secondary);">${dateStr}</div>
                        <div style="flex: 1; background: rgba(255,255,255,0.05); border-radius: 6px; height: 26px; position: relative; overflow: hidden;">
                            <div style="height: 100%; background: linear-gradient(90deg, var(--primary), var(--accent)); border-radius: 6px; width: ${Math.max(percentage, 5)}%; transition: width 0.5s ease;"></div>
                            <div style="position: absolute; top: 50%; left: 8px; transform: translateY(-50%); font-weight: 600; font-size: 0.8rem; color: white; text-shadow: 0 1px 3px rgba(0,0,0,0.5);">
                                ${displayValue}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            chartArea.innerHTML = html;
        }
        
        
        function setMetric(metric) {
            currentMetric = metric;
            
            // Toggle metric buttons
            const weightBtn = document.getElementById('weightBtn');
            const repsBtn = document.getElementById('repsBtn');
            
            if (weightBtn && repsBtn) {
                if (metric === 'weight') {
                    weightBtn.classList.add('active');
                    repsBtn.classList.remove('active');
                } else {
                    weightBtn.classList.remove('active');
                    repsBtn.classList.add('active');
                }
            }
            
            // Update chart with new metric
            updateProgressChart();
        }
        
        function loadSettings() {
            const saved = localStorage.getItem('userSettings');
            if (saved) {
                userSettings = JSON.parse(saved);
                applySettings();
            }
        }
        
        function saveSettings() {
            localStorage.setItem('userSettings', JSON.stringify(userSettings));
        }
        
        function applySettings() {
            const unitKg = document.getElementById('unitKg');
            const unitLbs = document.getElementById('unitLbs');
            if (unitKg) unitKg.classList.toggle('active', userSettings.weightUnit === 'kg');
            if (unitLbs) unitLbs.classList.toggle('active', userSettings.weightUnit === 'lbs');
            
            const weightBtnText = document.getElementById('weightBtnText');
            if (weightBtnText) {
                weightBtnText.textContent = `Weight (${userSettings.weightUnit})`;
            }
            
            document.querySelectorAll('.theme-option').forEach(opt => opt.classList.remove('active'));
            const themeId = 'theme' + userSettings.theme.charAt(0).toUpperCase() + userSettings.theme.slice(1);
            const themeElement = document.getElementById(themeId);
            if (themeElement) {
                themeElement.classList.add('active');
            }
            applyTheme(userSettings.theme);
        }
        
        function setWeightUnit(unit) {
            userSettings.weightUnit = unit;
            saveSettings();
            applySettings();
            
            const weightBtnText = document.getElementById('weightBtnText');
            if (weightBtnText) {
                weightBtnText.textContent = `Weight (${unit})`;
            }
            
            showToast(`âœ… Weight unit set to ${unit === 'kg' ? 'Kilograms' : 'Pounds'}`);
        }
        
        function setTheme(theme) {
            userSettings.theme = theme;
            saveSettings();
            applySettings();
        }
        
        function applyTheme(theme) {
            const root = document.documentElement;
            const themes = {
                default: {
                    gradient: 'linear-gradient(135deg, #1c1c1e 0%, #000000 50%, #1a0505 100%)',
                    primary: '#ff3b30',
                    primaryRgb: '255, 59, 48',
                    accent: '#ff375f'
                },
                blue: {
                    gradient: 'linear-gradient(135deg, #1a1a2e 0%, #0f0f1e 50%, #16213e 100%)',
                    primary: '#4a90e2',
                    primaryRgb: '74, 144, 226',
                    accent: '#5ca3f5'
                },
                green: {
                    gradient: 'linear-gradient(135deg, #1a2e1a 0%, #0f1e0f 50%, #1e3a20 100%)',
                    primary: '#52c768',
                    primaryRgb: '82, 199, 104',
                    accent: '#6ad87f'
                },
                purple: {
                    gradient: 'linear-gradient(135deg, #2e1a2e 0%, #1e0f1e 50%, #3a2040 100%)',
                    primary: '#a97bdc',
                    primaryRgb: '169, 123, 220',
                    accent: '#ba8fee'
                },
                ocean: {
                    gradient: 'linear-gradient(135deg, #1a2a2e 0%, #0f1a1e 50%, #1a3540 100%)',
                    primary: '#4eb8b8',
                    primaryRgb: '78, 184, 184',
                    accent: '#62d4d4'
                },
                sunset: {
                    gradient: 'linear-gradient(135deg, #2e1e1a 0%, #1e100f 50%, #3a2820 100%)',
                    primary: '#e8926f',
                    primaryRgb: '232, 146, 111',
                    accent: '#f5a783'
                },
                charcoal: {
                    gradient: 'linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 50%, #0a0a0a 100%)',
                    primary: '#8a8a8a',
                    primaryRgb: '138, 138, 138',
                    accent: '#a0a0a0'
                },
                midnight: {
                    gradient: 'linear-gradient(135deg, #1a1a2a 0%, #0f0f1a 50%, #1a1a35 100%)',
                    primary: '#7b8cde',
                    primaryRgb: '123, 140, 222',
                    accent: '#8fa0f0'
                }
            };
            
            const selectedTheme = themes[theme];
            const bgGradient = document.querySelector('.bg-gradient');
            if (bgGradient) {
                bgGradient.style.background = selectedTheme.gradient;
            }
            
            root.style.setProperty('--primary', selectedTheme.primary);
            root.style.setProperty('--primary-rgb', selectedTheme.primaryRgb);
            root.style.setProperty('--accent', selectedTheme.accent);
            
            root.style.setProperty('--primary-10', `rgba(${selectedTheme.primaryRgb}, 0.1)`);
            root.style.setProperty('--primary-20', `rgba(${selectedTheme.primaryRgb}, 0.2)`);
            root.style.setProperty('--primary-30', `rgba(${selectedTheme.primaryRgb}, 0.3)`);
            root.style.setProperty('--primary-40', `rgba(${selectedTheme.primaryRgb}, 0.4)`);
            root.style.setProperty('--primary-50', `rgba(${selectedTheme.primaryRgb}, 0.5)`);
            root.style.setProperty('--primary-60', `rgba(${selectedTheme.primaryRgb}, 0.6)`);
        }
        
        function kgToLbs(kg) {
            return (kg * 2.20462).toFixed(1);
        }
        
        function lbsToKg(lbs) {
            return (lbs / 2.20462).toFixed(1);
        }
        
        function formatWeight(weight) {
            if (userSettings.weightUnit === 'lbs') {
                return `${kgToLbs(weight)} lbs`;
            }
            return `${weight} kg`;
        }
        
        function getWeightUnit() {
            return userSettings.weightUnit === 'lbs' ? 'lbs' : 'kg';
        }
        
        function saveCustomExercises() {
            localStorage.setItem('customExercises', JSON.stringify(customExercises));
        }
        
        function addCustomExercise(name, muscleGroups) {
            
            // Validation - safety check
            if (!name || name.trim().length === 0) {
                console.error('Cannot add exercise with empty name');
                showToast('âš ï¸ Exercise name cannot be empty');
                return false;
            }
            
            if (!muscleGroups || muscleGroups.length === 0) {
                console.error('Cannot add exercise without muscle groups');
                showToast('âš ï¸ Please select at least one muscle group');
                return false;
            }
            
            const trimmedName = name.trim();
            const exercise = {
                name: trimmedName,
                muscleGroups: muscleGroups,
                custom: true
            };
            
            customExercises.push(exercise);
            saveCustomExercises();
            exerciseToMuscleGroups[trimmedName] = muscleGroups;
            
            // Add to favorites automatically
            if (!favoriteExercises.includes(trimmedName)) {
                favoriteExercises.push(trimmedName);
                saveFavorites();
            }
            
            updateCustomExercisesDropdown();
            updateExerciseDropdown(); // Refresh the dropdown
            return true;
        }
        
        function updateCustomExercisesDropdown() {
            const group = document.getElementById('customExercisesGroup');
            if (!group) return;
            
            if (customExercises.length === 0) {
                group.style.display = 'none';
                group.innerHTML = '';
                return;
            }
            
            group.style.display = '';
            group.innerHTML = customExercises.map(ex => 
                `<option value="${ex.name}">${ex.name}</option>`
            ).join('');
        }
        
        function openAddExerciseModal() {
            document.getElementById('addExerciseModal').classList.add('active');
            document.getElementById('newExerciseName').value = '';
            document.querySelectorAll('.muscle-checkbox').forEach(cb => cb.checked = false);
        }
        
        function closeAddExerciseModal() {
            document.getElementById('addExerciseModal').classList.remove('active');
        }
        
        function saveCustomExercise() {
            const nameInput = document.getElementById('newExerciseName');
            const name = nameInput ? nameInput.value.trim() : '';
            const selectedMuscles = Array.from(document.querySelectorAll('.muscle-checkbox:checked')).map(cb => cb.value);
            
            
            if (!name || name.length === 0) {
                showToast('âš ï¸ Please enter exercise name');
                return false;
            }
            
            if (!selectedMuscles || selectedMuscles.length === 0) {
                showToast('âš ï¸ Please select at least one muscle group');
                return false;
            }
            
            // Try to add the exercise
            const success = addCustomExercise(name, selectedMuscles);
            
            // Only continue if it was successful
            if (success) {
                closeAddExerciseModal();
                renderCustomExercises();
                showToast('âœ… Exercise added to library!');
                return true;
            } else {
                showToast('âŒ Failed to add exercise. Please try again.');
                return false;
            }
        }
        
        function renderCustomExercises() {
            const container = document.getElementById('customExercisesList');
            if (!container) return;
            
            if (customExercises.length === 0) {
                container.innerHTML = '<div style="color: var(--text-secondary); font-size: 0.9rem; text-align: center; padding: 10px;">No custom exercises yet</div>';
                return;
            }
            
            container.innerHTML = customExercises.map((ex, index) => `
                <div style="background: rgba(255,255,255,0.05); padding: 12px; border-radius: 8px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <div style="font-weight: 600;">${ex.name}</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 4px;">${ex.muscleGroups.join(', ')}</div>
                    </div>
                    <button onclick="deleteCustomExercise(${index})" style="background: var(--primary-20); border: none; color: var(--primary); padding: 6px 12px; border-radius: 6px; cursor: pointer;">Delete</button>
                </div>
            `).join('');
        }
        
        function deleteCustomExercise(index) {
            customExercises.splice(index, 1);
            saveCustomExercises();
            renderCustomExercises();
            showToast('âœ… Exercise deleted');
        }
        
        
        // Show install prompt for iOS Safari users (once per session)
        function checkInstallPrompt() {
            // Check if running in standalone mode
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches || 
                                window.navigator.standalone === true;
            
            // Check if user has dismissed the prompt before
            const hasSeenPrompt = localStorage.getItem('hasSeenInstallPrompt');
            
            // Check if iOS Safari
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
            
            if (isIOS && isSafari && !isStandalone && !hasSeenPrompt) {
                setTimeout(() => {
                    const install = confirm(
                        'ðŸ’ª GymLog works best as an app!\n\n' +
                        'Add to Home Screen for:\n' +
                        'âœ“ Fullscreen experience\n' +
                        'âœ“ Faster access\n' +
                        'âœ“ No browser bars\n\n' +
                        'Tap OK to see instructions!'
                    );
                    
                    if (install) {
                        showTab('settings');
                        setTimeout(() => {
                            const settingsContainer = document.getElementById('settingsContainer');
                            if (settingsContainer) {
                                settingsContainer.scrollTop = settingsContainer.scrollHeight;
                            }
                        }, 300);
                    }
                    
                    localStorage.setItem('hasSeenInstallPrompt', 'true');
                }, 2000);
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            updateDate();
            loadWorkouts();
            loadSettings();
            loadFavorites(); // Load favorite exercises
            checkInstallPrompt(); // Show install prompt if needed
        });
        
        if (document.readyState !== 'loading') {
            updateDate();
            loadWorkouts();
            loadSettings();
            loadFavorites();
            checkInstallPrompt();
        }
    </script>
</body>
</html>
